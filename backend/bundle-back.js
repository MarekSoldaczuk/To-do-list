!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("config")},function(e,t){e.exports=require("joi")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("lodash")},function(e,t,n){const s=n(7),o=n(2);e.exports=function(e,t,n){const r=e.header("x-auth-token");if(console.log(`In middleware, TOKEN: ${r}`),!r)return t.status(401).send("Access denied. No token provided.");try{const t=s.verify(r,o.get("jwtPrivateKey"));console.log(`DECODED token: ${t}`),e.user=t,n()}catch(e){console.log(e),t.status(400).send("Invalid token")}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){const s=n(0),o=n(3),r=n(2),i=n(7),a=new s.Schema({email:{type:String,unique:!0,minlength:5,maxlength:63,required:!0},registrationDate:{type:Date,default:Date.now},password:{type:String,required:!0,minlength:7,maxlength:1024}});a.methods.generateAuthToken=function(){return i.sign({_id:this._id},r.get("jwtPrivateKey"))};const d=s.model("User",a);t.User=d,t.validate=function(e){const t={email:o.string().min(5).max(63).required().email(),date:o.date(),password:o.string().min(7).max(255).required()};return o.validate(e,t)}},function(e,t,n){e.exports=n(10)},function(e,t,n){const s=n(2),o=n(0),r=n(11),i=n(12),a=n(13),d=n(15),u=n(6),c=n(1),l=c();s.get("jwtPrivateKey")||(console.log("FATAL ERROR: jwtPrivateKey is not defined"),process.exit(1)),o.connect("mongodb://localhost/to_do_list",{useUnifiedTopology:!0,useCreateIndex:!0,useNewUrlParser:!0}).then(()=>console.log("connected")).catch(e=>console.error("could not connect",e)),l.use(c.json()),l.use(r()),l.use("/api/users",i),l.use("/api/lists",u,a),l.use("/api/auth",d);const f=process.env.PORT||3e3;l.listen(f,()=>console.log(`listening on port ${f}...`))},function(e,t){e.exports=require("cors")},function(e,t,n){const s=n(4),o=n(5),r=n(6),{User:i,validate:a}=n(8),d=(n(0),n(1).Router());d.post("/",async(e,t)=>{console.log("POST user");const{error:n}=a(e.body);if(n)return t.status(400).send(n.details[0].message);let r=await i.findOne({email:e.body.email});if(r)return t.status(400).send("User already registered.");r=new i(o.pick(e.body,["email","password"]));const d=await s.genSalt(10);r.password=await s.hash(r.password,d),await r.save();const u=r.generateAuthToken();t.header("x-auth-token",u).send(o.pick(r,["_id","email"]))}),d.get("/me",r,async(e,t)=>{console.log("GET user");const n=await i.findById(e.user._id);t.send(o.pick(n,["_id","email"]))}),e.exports=d},function(e,t,n){n(0);const{List:s,validate:o}=n(14),r=n(1).Router();r.post("/",async(e,t)=>{const{error:n}=o(e.body);if(n)return t.status(400).send(n.details[0].message);let r=new s({});r.name=e.body.name,r.userId=e.user._id,r.items=e.body.items,r=await r.save(),t.send(r)}),r.get("/",async(e,t)=>{console.log(`req.user: ${JSON.stringify(e.user)}`);const n=await s.find({userId:e.user._id}).sort("name");t.send(n)}),r.get("/:id",async(e,t)=>{const n=await s.findById(e.params.id);if(n.userId!==e.user._id)return t.status(404).send("The list with the given user ID was not found.");t.send(n)}),r.delete("/:id",async(e,t)=>{const n=await s.findByIdAndRemove(e.params.id);if(!n)return t.status(404).send("The list with the given ID was not found.");t.send(n)}),r.put("/:id",async(e,t)=>{let n=await s.findById(e.params.id);n||t.status(404).send("The course with the given ID was not found");const{error:r}=o(e.body);if(r)return t.status(400).send(r.details[0].message);n.name=e.body.name,n.items=e.body.items,n=await n.save(),t.send(n)}),e.exports=r},function(e,t,n){const s=n(0),o=n(3),r=new s.Schema({name:{type:String,maxlength:63,default:"New List"},userId:{type:String},items:[{name:String,done:Boolean}]}),i=s.model("List",r);t.List=i,t.validate=function(e){const t={name:o.string().max(63),items:o.array().optional()};return o.validate(e,t)}},function(e,t,n){const s=n(4),o=n(3),{User:r}=(n(5),n(8)),i=(n(0),n(1).Router());i.post("/",async(e,t)=>{const{error:n}=function(e){const t={email:o.string().min(5).max(63).required().email(),password:o.string().min(7).max(255).required()};return o.validate(e,t)}(e.body);if(n)return t.status(400).send("Invalid email or passwword.");let i=await r.findOne({email:e.body.email});if(!i)return t.status(400).send("Invalid email or passwword.");if(!await s.compare(e.body.password,i.password))return t.status(400).send("Invalid email or passwword.");const a=i.generateAuthToken();t.send(a)}),e.exports=i}]);